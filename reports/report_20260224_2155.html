<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Arirang Learner Report</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --ink: #1f2937;
      --muted: #6b7280;
      --line: #dbe1ea;
      --accent: #1e40af;
      --good: #15803d;
      --warn: #b45309;
      --bad: #b91c1c;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font-family: "Segoe UI", "Noto Sans KR", sans-serif;
    }
    .container {
      max-width: 1120px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      gap: 16px;
    }
    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 16px;
    }
    .hero {
      color: #fff;
      border: 0;
      background:
        radial-gradient(circle at 80% 20%, rgba(255,255,255,0.22), transparent 35%),
        linear-gradient(135deg, #1d4ed8 0%, #0f766e 55%, #0b132b 100%);
    }
    .hero h1 { margin: 0 0 8px; font-size: 24px; }
    .hero .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 12px;
      font-size: 14px;
      opacity: 0.95;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.2);
      font-weight: 600;
    }
    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .cefr-chart {
      display: flex;
      align-items: end;
      gap: 8px;
      min-height: 74px;
    }
    .cefr-col {
      width: 34px;
      text-align: center;
      font-size: 11px;
      color: #e2e8f0;
    }
    .cefr-bar {
      width: 100%;
      border-radius: 8px 8px 2px 2px;
      background: rgba(255,255,255,0.86);
      margin-bottom: 4px;
      min-height: 6px;
    }
    .audio-wrap { display: block; }
    audio { width: 100%; }
    .script-box {
      max-height: 400px;
      overflow: auto;
      white-space: pre-wrap;
      line-height: 1.7;
      padding: 12px;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #fbfdff;
    }
    .script-box.expanded {
      max-height: none;
    }
    .script-tools {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }
    .script-hint {
      font-size: 12px;
      color: var(--muted);
    }
    .script-toggle {
      border: 1px solid var(--line);
      background: #fff;
      color: var(--ink);
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
    }
    mark {
      background: transparent;
      cursor: pointer;
      padding: 0 1px;
      border-radius: 2px;
      transition: background 0.15s ease;
    }
    mark:hover { background: rgba(59,130,246,0.12); }
    .mark-b2 { border-bottom: 3px solid #facc15; }
    .mark-c1 { border-bottom: 3px solid #fb923c; }
    .mark-c2 { border-bottom: 3px solid #ef4444; }
    .cards-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
    .v-card {
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      background: #fff;
      position: relative;
    }
    .v-card.bookmarked {
      border: 2px solid #f59e0b;
      box-shadow: 0 0 0 2px rgba(245,158,11,0.15) inset;
    }
    .card-top {
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 8px;
      padding-right: 28px;
    }
    .word { font-size: 20px; font-weight: 700; }
    .cefr {
      font-size: 11px;
      font-weight: 700;
      border-radius: 999px;
      border: 1px solid var(--line);
      padding: 2px 8px;
    }
    .phonetic { color: var(--muted); font-size: 13px; }
    .sub {
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 8px;
    }
    .bookmark-btn {
      position: absolute;
      right: 8px;
      top: 8px;
      border: 0;
      background: transparent;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
    }
    .bookmark-btn[aria-pressed="true"] { filter: saturate(160%); }
    .card-body { display: none; margin-top: 8px; }
    .v-card.open .card-body { display: block; }
    .def-box {
      background: #f3f4f6;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .ko {
      color: var(--good);
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .example {
      font-style: italic;
      color: #374151;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .context {
      border-left: 4px solid #3b82f6;
      padding: 8px;
      background: #eff6ff;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .tag {
      border: 1px solid var(--line);
      border-radius: 999px;
      font-size: 12px;
      padding: 2px 8px;
      color: #374151;
      background: #fff;
    }
    .quiz-list { display: grid; gap: 12px; }
    .q {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
      background: #fff;
    }
    .q .stem { margin-bottom: 8px; }
    .choices {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }
    .choice {
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 8px;
      padding: 8px;
      text-align: left;
      cursor: pointer;
    }
    .choice.correct { background: #dcfce7; border-color: #16a34a; }
    .choice.wrong { background: #fee2e2; border-color: #ef4444; }
    .q-result {
      margin-top: 8px;
      font-size: 13px;
      color: #334155;
    }
    .progress {
      height: 10px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 8px;
    }
    .progress > i {
      display: block;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #16a34a, #22c55e);
      transition: width 0.2s ease;
    }
    @media (max-width: 600px) {
      .cards-grid { grid-template-columns: 1fr; }
      .choices { grid-template-columns: 1fr; }
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1220;
        --card: #111827;
        --ink: #e5e7eb;
        --muted: #9ca3af;
        --line: #253041;
      }
      .script-box { background: #0f172a; }
      .def-box { background: #1f2937; }
      .context { background: #0b2947; }
      .choice { background: #0f172a; }
      .q { background: #111827; }
    }
    @media print {
      .audio-wrap, .quiz-section { display: none !important; }
      .v-card .card-body { display: block !important; }
      .container { max-width: 100%; padding: 0; }
    }
  </style>
</head>
<body>
  <div class="container">
    <section class="panel hero">
      <h1 id="news-title"></h1>
      <div class="meta" id="news-meta"></div>
      <div class="header-row">
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge" id="vocab-count-badge"></span>
          <span class="badge" id="bookmark-count-badge">Î∂ÅÎßàÌÅ¨ 0Í∞ú</span>
        </div>
        <div class="cefr-chart" id="cefr-chart"></div>
      </div>
    </section>

    <section class="panel audio-wrap" id="audio-section">
      <h2>Audio Player</h2>
      <audio controls id="audio-player"></audio>
    </section>

    <section class="panel">
      <h2>Script Viewer</h2>
      <div class="script-tools">
        <div class="script-hint">Ïä§ÌÅ¨Î°§Î°ú Ï†ÑÏ≤¥ ÌôïÏù∏ Í∞ÄÎä• ¬∑ ÌïÑÏöî Ïãú Ï†ÑÏ≤¥Î≥¥Í∏∞</div>
        <button id="script-toggle" class="script-toggle" type="button">Ï†ÑÏ≤¥Î≥¥Í∏∞</button>
      </div>
      <div class="script-box" id="script-box"></div>
    </section>

    <section class="panel">
      <div class="cards-head">
        <h2 style="margin:0;">Vocabulary Cards</h2>
      </div>
      <div class="cards-grid" id="cards-grid"></div>
    </section>

    <section class="panel quiz-section" id="quiz-section">
      <h2>ÎπàÏπ∏ ÌÄ¥Ï¶à</h2>
      <div id="quiz-score">0 / 0</div>
      <div class="progress"><i id="quiz-progress"></i></div>
      <div class="quiz-list" id="quiz-list" style="margin-top:12px;"></div>
    </section>
  </div>

  <script>
    const episode = {"date_display": "2026.02.24", "airtime": "21:55", "title": "21:55 Arirang News", "mp3_filename": "20260224_2155_arirang.mp3", "mp3_url": "https://amdlive-ch03-ctnd-com.akamaized.net/arirang_3ch/smil:arirang_3ch.smil/playlist.m3u8", "script_text": ""};
    const rawVocabData = [{"word": "policymaking", "lemma": "policymake", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "Kim Yo-jong was also reinstated as an alternate member of the Politburo, the Party's highest policymaking body, after having been demoted to an ordinary Central Committee member five years ago.", "cefr_level": "C2", "frequency_score": 8.0, "is_b2_plus": false, "derivatives": []}, {"word": "proceed", "lemma": "procee", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "2. South Korean Ambassador to the United States Kang Kyung-wha says Seoul will actively work with Washington to ensure trade discussions proceed in a \"friendly atmosphere.\"", "cefr_level": "C2", "frequency_score": 8.0, "is_b2_plus": false, "derivatives": []}, {"word": "sublicense", "lemma": "sublicense", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "However, negotiations to sublicense coverage to other Korean broadcasters ultimately collapsed, reportedly due to the high costs.", "cefr_level": "C2", "frequency_score": 7.6308, "is_b2_plus": false, "derivatives": []}, {"word": "hynix", "lemma": "hynix", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "On Tuesday, Samsung Electronics and SK hynix closed above the 200,000 won and 1 million won marks, respectively, pushing up the index.", "cefr_level": "C2", "frequency_score": 7.1302, "is_b2_plus": false, "derivatives": []}, {"word": "JTBC", "lemma": "jtbc", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "JTBC secured broadcast rights for the Olympics from 2026 through 2032 from the International Olympic Committee in 2019.", "cefr_level": "C1", "frequency_score": 6.9393, "is_b2_plus": false, "derivatives": []}, {"word": "sunnier", "lemma": "sunnier", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "bright and pleasant; promoting a feeling of cheer", "translation_ko": "", "example_en": "a cheery hello", "context_sentence": "By the afternoon, Seoul gets up to 15 degrees under sunnier skies, but southern regions will be cloudy with Busan and Jeju topping out at 14 degrees with decent air quality nationwide.", "cefr_level": "C1", "frequency_score": 6.8013, "is_b2_plus": false, "derivatives": ["cheery", "gay", "sunny"]}, {"word": "lawmaking", "lemma": "lawmaking", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "the act of making or enacting laws", "translation_ko": "", "example_en": "", "context_sentence": "Speaking at a Cabinet meeting this morning, Lee said he sees it difficult to actively deal with changes in the global order with lawmaking \"at current speed.\"", "cefr_level": "C1", "frequency_score": 6.7399, "is_b2_plus": false, "derivatives": ["legislating", "legislation"]}, {"word": "demoted", "lemma": "demote", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "assign to a lower position; reduce in rank", "translation_ko": "", "example_en": "She was demoted because she always speaks up", "context_sentence": "Kim Yo-jong was also reinstated as an alternate member of the Politburo, the Party's highest policymaking body, after having been demoted to an ordinary Central Committee member five years ago.", "cefr_level": "C1", "frequency_score": 6.71, "is_b2_plus": false, "derivatives": ["break", "bump", "kick downstairs", "relegate"]}, {"word": "bourse", "lemma": "bourse", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "/b…îÀês/", "definition_en": "the stock exchange in Paris", "translation_ko": "", "example_en": "", "context_sentence": "6. Lastly to local bourse, South Korean stocks closed higher from the day before.", "cefr_level": "C1", "frequency_score": 6.52, "is_b2_plus": false, "derivatives": ["Bourse"]}, {"word": "data", "lemma": "datum", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "an item of factual information derived from measurement or research", "translation_ko": "", "example_en": "", "context_sentence": "Recent data show that the government's efforts to tackle the heated real estate market seem to be working.", "cefr_level": "C1", "frequency_score": 6.4802, "is_b2_plus": false, "derivatives": ["data point"]}, {"word": "congratulations", "lemma": "congratulation", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "/k…ônÀå…°…π√¶tj äÀàle…™ É(…ô)n/", "definition_en": "the act of acknowledging that someone has an occasion for celebration", "translation_ko": "", "example_en": "", "context_sentence": "President Lee Jae Myung... for his online post of congratulations on her party's recent victory in the Lower House snap election.", "cefr_level": "C1", "frequency_score": 6.27, "is_b2_plus": false, "derivatives": ["felicitation"]}, {"word": "penalize", "lemma": "penalize", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "impose a penalty on; inflict punishment on", "translation_ko": "", "example_en": "The students were penalized for showing up late for class", "context_sentence": "The ruling party then introduced revisions to the Commercial Act, along with three judicial reform bills that would expand the Supreme Court, establish a new appeals system, and penalize officials accused of distorting legal rulings.", "cefr_level": "C1", "frequency_score": 6.2596, "is_b2_plus": false, "derivatives": ["penalise", "punish"]}, {"word": "reassess", "lemma": "reassess", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "revise or renew one's assessment", "translation_ko": "", "example_en": "", "context_sentence": "The ruling has created uncertainty worldwide, as governments reassess the status of trade deals negotiated in response to those tariffs.", "cefr_level": "C1", "frequency_score": 6.2, "is_b2_plus": false, "derivatives": ["reevaluate"]}, {"word": "reaffirmed", "lemma": "reaffirm", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "affirm once again", "translation_ko": "", "example_en": "He reaffirmed his faith in the church", "context_sentence": "To continue this momentum, Lee and Lula reaffirmed the importance of striking a trade agreement between South Korea and the Mercosur bloc of South American countries.", "cefr_level": "C1", "frequency_score": 6.1701, "is_b2_plus": false, "derivatives": []}, {"word": "plummeted", "lemma": "plummet", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "the metal bob of a plumb line", "translation_ko": "", "example_en": "", "context_sentence": "According to the Bank of Korea, the Housing Price Outlook Consumer Sentiment Index plummeted to 108 in February.", "cefr_level": "C1", "frequency_score": 6.15, "is_b2_plus": false, "derivatives": ["plumb", "plumb bob", "plump"]}, {"word": "centimeters", "lemma": "centimeter", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "a metric unit of length equal to one hundredth of a meter", "translation_ko": "", "example_en": "", "context_sentence": "Western parts of Gyeongsang-do could get up to 10 centimeters of snow, with a chance of a heavy snow advisory being issued.", "cefr_level": "C1", "frequency_score": 6.1101, "is_b2_plus": false, "derivatives": ["centimetre", "cm"]}, {"word": "filibuster", "lemma": "filibuster", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "a legislator who gives long speeches in an effort to delay or obstruct legislation that he (or she) opposes", "translation_ko": "", "example_en": "", "context_sentence": "5. South Korea‚Äôs National Assembly is heading into what could be its longest plenary session, after an opposition-led filibuster was triggered by a series of controversial bills backed by the ruling party.", "cefr_level": "C1", "frequency_score": 6.1101, "is_b2_plus": false, "derivatives": ["filibusterer"]}, {"word": "finalized", "lemma": "finalize", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "/Ààfa…™n…ôla…™z/", "definition_en": "make final; put the last touches on; put into final form", "translation_ko": "", "example_en": "let's finalize the proposal", "context_sentence": "4. South Korea has finalized its medical school quota increase after a prolonged dispute since 2024.", "cefr_level": "C1", "frequency_score": 6.1101, "is_b2_plus": false, "derivatives": ["finalise", "nail down", "settle"]}, {"word": "fluctuations", "lemma": "fluctuation", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "/fl åkt ÉuÀêÀàe…™ É…ôn/", "definition_en": "a wave motion", "translation_ko": "", "example_en": "the fluctuations of the sea", "context_sentence": "He said inflation will likely remain stable near the bank's 2 percent target; however, he pointed to international oil prices, exchange rate fluctuations, and stock market volatility as key risks.", "cefr_level": "C1", "frequency_score": 6.1101, "is_b2_plus": true, "derivatives": ["variation", "wavering"]}, {"word": "laborers", "lemma": "laborer", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "someone who works with their hands; someone engaged in manual labor", "translation_ko": "", "example_en": "", "context_sentence": "Both leaders rose from humble beginnings, having worked as child laborers.", "cefr_level": "C1", "frequency_score": 6.1101, "is_b2_plus": false, "derivatives": ["jack", "labourer", "manual laborer"]}, {"word": "sharpest", "lemma": "sharpest", "pos": "ADV", "pos_ko": "Î∂ÄÏÇ¨", "phonetic": "", "definition_en": "(of something seen or heard) clearly defined", "translation_ko": "", "example_en": "a sharp photographic image", "context_sentence": "It reverses the months-long climb ‚Äî from 119 in November and 121 in December ‚Äî and marks the sharpest psychological cooling the nation has seen in years.", "cefr_level": "C1", "frequency_score": 6.0899, "is_b2_plus": false, "derivatives": ["acuate", "acute", "astute", "crisp", "discriminating", "incisive", "keen", "knifelike", "needlelike", "penetrating", "penetrative", "piercing", "sharp", "sharp-worded", "shrewd"]}, {"word": "dryness", "lemma": "dryness", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "the condition of not containing or being covered by a liquid (especially water)", "translation_ko": "", "example_en": "", "context_sentence": "Moving to weather forecast, After a prolonged stretch of very dry weather, rain and snow are finally arriving nationwide today, helping to ease the dryness.", "cefr_level": "C1", "frequency_score": 6.0701, "is_b2_plus": false, "derivatives": ["dispassion", "dispassionateness", "sobriety", "waterlessness", "xerotes"]}, {"word": "spotty", "lemma": "spotty", "pos": "ADJ", "pos_ko": "ÌòïÏö©ÏÇ¨", "phonetic": "", "definition_en": "having spots or patches (small areas of contrasting color or texture)", "translation_ko": "", "example_en": "a field patched with ice and snow", "context_sentence": "But the capital area will see spotty rain.", "cefr_level": "C1", "frequency_score": 6.06, "is_b2_plus": false, "derivatives": ["patched", "scratchy", "spotted", "uneven"]}, {"word": "hoon", "lemma": "hoon", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "This is Park Kee hoon", "cefr_level": "C1", "frequency_score": 6.0101, "is_b2_plus": false, "derivatives": []}, {"word": "normalize", "lemma": "normalize", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "become normal or return to its normal state", "translation_ko": "", "example_en": "Let us hope that relations with this country will normalize soon", "context_sentence": "The cooling follows after the government tried to, quote, \"normalize\" the real estate market.", "cefr_level": "C1", "frequency_score": 6.0, "is_b2_plus": false, "derivatives": ["anneal", "normalise", "renormalise", "renormalize", "temper"]}, {"word": "lawmakers", "lemma": "lawmaker", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "a maker of laws; someone who gives a code of laws", "translation_ko": "", "example_en": "", "context_sentence": "During Tuesday's session, lawmakers first voted to approve the arrest of former Democratic Party lawmaker Kang Sun-woo, who is accused of accepting illegal campaign donations.", "cefr_level": "B2", "frequency_score": 5.9318, "is_b2_plus": false, "derivatives": ["lawgiver"]}, {"word": "distorting", "lemma": "distort", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "make false by mutilation or addition; as of a message or story", "translation_ko": "", "example_en": "", "context_sentence": "The ruling party then introduced revisions to the Commercial Act, along with three judicial reform bills that would expand the Supreme Court, establish a new appeals system, and penalize officials accused of distorting legal rulings.", "cefr_level": "B2", "frequency_score": 5.9208, "is_b2_plus": false, "derivatives": ["color", "colour", "contort", "deform", "falsify", "garble", "strain", "tinge", "twine", "twist", "warp", "wring"]}, {"word": "importers", "lemma": "importer", "pos": "NOUN", "pos_ko": "Î™ÖÏÇ¨", "phonetic": "", "definition_en": "someone whose business involves importing goods from outside (especially from a foreign country)", "translation_ko": "", "example_en": "India is the world's biggest importer of gold.", "context_sentence": "Just hours before the imposition of 15 percent tariff, U.S. Customs and Border Protection issued guidance to importers confirming the initial 10 percent rate applies for now.", "cefr_level": "B2", "frequency_score": 5.9208, "is_b2_plus": false, "derivatives": []}, {"word": "obstructing", "lemma": "obstruct", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "/…ôbÀàst…π åkt/", "definition_en": "hinder or prevent the progress or accomplishment of", "translation_ko": "", "example_en": "His brother blocked him at every turn", "context_sentence": "President Vladimir Putin accused Ukraine of obstructing peace negotiations and warned there would be consequences for any nuclear strike against Russia.", "cefr_level": "B2", "frequency_score": 5.9101, "is_b2_plus": false, "derivatives": ["block", "blockade", "close up", "embarrass", "hinder", "impede", "jam", "obturate", "occlude", "stymie", "stymy"]}, {"word": "reinstated", "lemma": "reinstate", "pos": "VERB", "pos_ko": "ÎèôÏÇ¨", "phonetic": "", "definition_en": "restore to the previous state or rank", "translation_ko": "", "example_en": "", "context_sentence": "Kim Yo-jong was also reinstated as an alternate member of the Politburo, the Party's highest policymaking body, after having been demoted to an ordinary Central Committee member five years ago.", "cefr_level": "B2", "frequency_score": 5.9101, "is_b2_plus": false, "derivatives": ["reestablish", "restore"]}];
    const vocabData = JSON.parse(JSON.stringify(rawVocabData));
    const bookmarksKey = "arirang_bookmarks";

    function escHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }

    function loadBookmarks() {
      try {
        return JSON.parse(localStorage.getItem(bookmarksKey) || "{}");
      } catch (_) {
        return {};
      }
    }

    function saveBookmarks(bm) {
      localStorage.setItem(bookmarksKey, JSON.stringify(bm));
    }

    function cefrClass(level) {
      if (level === "C2") return "mark-c2";
      if (level === "C1") return "mark-c1";
      if (level === "B2") return "mark-b2";
      return "";
    }

    function openCard(lemma) {
      const el = document.getElementById("card-" + lemma);
      if (!el) return;
      el.classList.add("open");
      el.scrollIntoView({ behavior: "smooth", block: "center" });
    }

    function renderHeader() {
      document.getElementById("news-title").textContent = episode.title || "Arirang News";
      document.getElementById("news-meta").innerHTML =
        "<span>" + escHtml(episode.date_display || "") + "</span>" +
        "<span>‚Ä¢</span>" +
        "<span>" + escHtml(episode.airtime || "21:55") + "</span>";

      document.getElementById("vocab-count-badge").textContent = "Ïñ¥Ìúò " + vocabData.length + "Í∞ú";

      const dist = { B2:0, C1:0, C2:0 };
      for (const v of vocabData) {
        if (v.cefr_level === "B2") dist.B2++;
        if (v.cefr_level === "C1") dist.C1++;
        if (v.cefr_level === "C2") dist.C2++;
      }
      const max = Math.max(1, dist.B2, dist.C1, dist.C2);
      const chart = document.getElementById("cefr-chart");
      chart.innerHTML = ["B2","C1","C2"].map(k => {
        const h = Math.max(6, Math.round((dist[k] / max) * 56));
        return "<div class='cefr-col'>" +
               "<div class='cefr-bar' style='height:" + h + "px'></div>" +
               "<div>" + k + "</div>" +
               "</div>";
      }).join("");
    }

    function renderAudio() {
      const section = document.getElementById("audio-section");
      const player = document.getElementById("audio-player");
      if (!episode.mp3_filename && !episode.mp3_url) {
        section.style.display = "none";
        return;
      }
      if (episode.mp3_filename) {
        // report file is in reports/, media files are in downloads/
        player.src = "../downloads/" + episode.mp3_filename;
      } else {
        player.src = episode.mp3_url;
      }
    }

    function renderScript() {
      const box = document.getElementById("script-box");
      const toggle = document.getElementById("script-toggle");
      let text = escHtml(episode.script_text || "");
      if (!text) {
        box.textContent = "Ïä§ÌÅ¨Î¶ΩÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.";
        toggle.style.display = "none";
        return;
      }

      const sorted = [...vocabData]
        .filter(v => v.word)
        .sort((a,b) => String(b.word).length - String(a.word).length);

      for (const item of sorted) {
        const word = String(item.word || "").trim();
        if (!word) continue;
        const lemma = String(item.lemma || "").trim();
        const cls = cefrClass(item.cefr_level);
        const pattern = new RegExp("\\b(" + word.replace(/[.*+?^${}()|[\\]\\]/g, "\\$&") + ")\\b", "gi");
        text = text.replace(pattern, (m) => {
          return "<mark class='" + cls + "' data-lemma='" + escHtml(lemma) + "'>" + escHtml(m) + "</mark>";
        });
      }

      box.innerHTML = text;
      box.querySelectorAll("mark[data-lemma]").forEach((el) => {
        el.addEventListener("click", () => openCard(el.getAttribute("data-lemma")));
      });

      toggle.addEventListener("click", () => {
        box.classList.toggle("expanded");
        toggle.textContent = box.classList.contains("expanded") ? "Ï†ëÍ∏∞" : "Ï†ÑÏ≤¥Î≥¥Í∏∞";
      });
    }

    function renderCards() {
      const bm = loadBookmarks();
      const grid = document.getElementById("cards-grid");
      grid.innerHTML = vocabData.map((v) => {
        const lemma = escHtml(v.lemma || "");
        const ko = String(v.translation_ko || "").trim() || "ÏÇ¨Ï†Ñ ÎØ∏Îì±Î°ù";
        const deriv = Array.isArray(v.derivatives) ? v.derivatives : [];
        const tags = deriv.map(x => "<span class='tag'>" + escHtml(x) + "</span>").join("");
        const bookmarked = bm[v.word] ? "bookmarked" : "";
        const pressed = bm[v.word] ? "true" : "false";
        return "<article class='v-card " + bookmarked + "' id='card-" + lemma + "'>" +
               "<button class='bookmark-btn' data-word='" + escHtml(v.word) + "' aria-pressed='" + pressed + "'>üîñ</button>" +
               "<div class='card-top'>" +
               "<span class='word'>" + escHtml(v.word || "") + "</span>" +
               "<span class='cefr'>" + escHtml(v.cefr_level || "") + "</span>" +
               "<span class='phonetic'>" + escHtml(v.phonetic || "") + "</span>" +
               "</div>" +
               "<div class='sub'>" + escHtml(v.pos_ko || "") + " ¬∑ ÎπàÎèÑÏ†êÏàò " + escHtml(v.frequency_score) + "</div>" +
               "<div class='card-body'>" +
               "<div class='def-box'>" + escHtml(v.definition_en || "") + "</div>" +
               "<div class='ko'>" + escHtml(ko) + "</div>" +
               "<div class='example'>" + escHtml(v.example_en || "") + "</div>" +
               "<div class='context'>" + escHtml(v.context_sentence || "") + "</div>" +
               "<div class='tags'>" + tags + "</div>" +
               "</div>" +
               "</article>";
      }).join("");

      grid.querySelectorAll(".v-card").forEach((card) => {
        card.addEventListener("click", (ev) => {
          if (ev.target && ev.target.classList.contains("bookmark-btn")) return;
          card.classList.toggle("open");
        });
      });

      grid.querySelectorAll(".bookmark-btn").forEach((btn) => {
        btn.addEventListener("click", (ev) => {
          ev.stopPropagation();
          const word = btn.getAttribute("data-word");
          const store = loadBookmarks();
          store[word] = !store[word];
          if (!store[word]) delete store[word];
          saveBookmarks(store);
          renderCards();
          updateBookmarkCount();
        });
      });
    }

    function updateBookmarkCount() {
      const bm = loadBookmarks();
      const n = Object.keys(bm).length;
      document.getElementById("bookmark-count-badge").textContent = "Î∂ÅÎßàÌÅ¨ " + n + "Í∞ú";
    }

    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function buildQuizItems() {
      const withCtx = vocabData.filter(v => v.context_sentence && v.word);
      const picked = shuffle(withCtx).slice(0, 5);
      const words = vocabData.map(v => v.word).filter(Boolean);
      return picked.map((q, idx) => {
        const answer = q.word;
        const wrongPool = shuffle(words.filter(w => w !== answer)).slice(0, 3);
        const choices = shuffle([answer, ...wrongPool]);
        const stem = q.context_sentence.replace(new RegExp("\\b" + answer.replace(/[.*+?^${}()|[\\]\\]/g, "\\$&") + "\\b", "i"), "______");
        return {
          id: idx + 1,
          answer,
          choices,
          stem,
          definition: q.definition_en || ""
        };
      });
    }

    function renderQuiz() {
      const list = document.getElementById("quiz-list");
      const scoreEl = document.getElementById("quiz-score");
      const progress = document.getElementById("quiz-progress");
      const items = buildQuizItems();
      if (!items.length) {
        document.getElementById("quiz-section").style.display = "none";
        return;
      }

      let answered = 0;
      let correct = 0;

      function refresh() {
        scoreEl.textContent = correct + " / " + items.length;
        progress.style.width = Math.round((answered / items.length) * 100) + "%";
      }

      list.innerHTML = items.map((q) => {
        return "<div class='q' data-id='" + q.id + "'>" +
               "<div class='stem'><strong>Q" + q.id + ".</strong> " + escHtml(q.stem) + "</div>" +
               "<div class='choices'>" +
               q.choices.map(c => "<button class='choice' data-choice='" + escHtml(c) + "'>" + escHtml(c) + "</button>").join("") +
               "</div>" +
               "<div class='q-result'></div>" +
               "</div>";
      }).join("");

      list.querySelectorAll(".q").forEach((qEl) => {
        const id = Number(qEl.getAttribute("data-id"));
        const q = items.find(x => x.id === id);
        if (!q) return;
        let done = false;
        qEl.querySelectorAll(".choice").forEach((btn) => {
          btn.addEventListener("click", () => {
            if (done) return;
            done = true;
            answered++;
            const picked = btn.getAttribute("data-choice");
            const result = qEl.querySelector(".q-result");
            qEl.querySelectorAll(".choice").forEach((b) => {
              const val = b.getAttribute("data-choice");
              if (val === q.answer) b.classList.add("correct");
            });
            if (picked === q.answer) {
              correct++;
              btn.classList.add("correct");
              result.textContent = "Ï†ïÎãµ! " + (q.definition ? q.definition : "");
            } else {
              btn.classList.add("wrong");
              result.textContent = "Ïò§Îãµ. Ï†ïÎãµ: " + q.answer + (q.definition ? " | " + q.definition : "");
            }
            refresh();
          });
        });
      });

      refresh();
    }

    renderHeader();
    renderAudio();
    renderScript();
    renderCards();
    updateBookmarkCount();
    renderQuiz();
  </script>
</body>
</html>
