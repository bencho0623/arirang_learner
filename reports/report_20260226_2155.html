<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Arirang Learner Report</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --ink: #1f2937;
      --muted: #6b7280;
      --line: #dbe1ea;
      --accent: #1e40af;
      --good: #15803d;
      --warn: #b45309;
      --bad: #b91c1c;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font-family: "Segoe UI", "Noto Sans KR", sans-serif;
    }
    .container {
      max-width: 1120px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      gap: 16px;
    }
    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 16px;
    }
    .hero {
      color: #fff;
      border: 0;
      background:
        radial-gradient(circle at 80% 20%, rgba(255,255,255,0.22), transparent 35%),
        linear-gradient(135deg, #1d4ed8 0%, #0f766e 55%, #0b132b 100%);
    }
    .hero h1 { margin: 0 0 8px; font-size: 24px; }
    .hero .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 12px;
      font-size: 14px;
      opacity: 0.95;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.2);
      font-weight: 600;
    }
    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .cefr-chart {
      display: flex;
      align-items: end;
      gap: 8px;
      min-height: 74px;
    }
    .cefr-col {
      width: 34px;
      text-align: center;
      font-size: 11px;
      color: #e2e8f0;
    }
    .cefr-bar {
      width: 100%;
      border-radius: 8px 8px 2px 2px;
      background: rgba(255,255,255,0.86);
      margin-bottom: 4px;
      min-height: 6px;
    }
    .audio-wrap { display: block; }
    audio { width: 100%; }
    .script-box {
      max-height: 400px;
      overflow: auto;
      white-space: pre-wrap;
      line-height: 1.7;
      padding: 12px;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #fbfdff;
    }
    .script-box.expanded {
      max-height: none;
    }
    .script-tools {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }
    .script-hint {
      font-size: 12px;
      color: var(--muted);
    }
    .script-toggle {
      border: 1px solid var(--line);
      background: #fff;
      color: var(--ink);
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
    }
    mark {
      background: transparent;
      cursor: pointer;
      padding: 0 1px;
      border-radius: 2px;
      transition: background 0.15s ease;
    }
    mark:hover { background: rgba(59,130,246,0.12); }
    .mark-b2 { border-bottom: 3px solid #facc15; }
    .mark-c1 { border-bottom: 3px solid #fb923c; }
    .mark-c2 { border-bottom: 3px solid #ef4444; }
    .cards-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
    .v-card {
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      background: #fff;
      position: relative;
    }
    .v-card.bookmarked {
      border: 2px solid #f59e0b;
      box-shadow: 0 0 0 2px rgba(245,158,11,0.15) inset;
    }
    .card-top {
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 8px;
      padding-right: 28px;
    }
    .word { font-size: 20px; font-weight: 700; }
    .cefr {
      font-size: 11px;
      font-weight: 700;
      border-radius: 999px;
      border: 1px solid var(--line);
      padding: 2px 8px;
    }
    .phonetic { color: var(--muted); font-size: 13px; }
    .sub {
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 8px;
    }
    .bookmark-btn {
      position: absolute;
      right: 8px;
      top: 8px;
      border: 0;
      background: transparent;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
    }
    .bookmark-btn[aria-pressed="true"] { filter: saturate(160%); }
    .card-body { display: none; margin-top: 8px; }
    .v-card.open .card-body { display: block; }
    .def-box {
      background: #f3f4f6;
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .ko {
      color: var(--good);
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .example {
      font-style: italic;
      color: #374151;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .context {
      border-left: 4px solid #3b82f6;
      padding: 8px;
      background: #eff6ff;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 14px;
    }
    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .tag {
      border: 1px solid var(--line);
      border-radius: 999px;
      font-size: 12px;
      padding: 2px 8px;
      color: #374151;
      background: #fff;
    }
    .quiz-list { display: grid; gap: 12px; }
    .q {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
      background: #fff;
    }
    .q .stem { margin-bottom: 8px; }
    .choices {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }
    .choice {
      border: 1px solid var(--line);
      background: #fff;
      border-radius: 8px;
      padding: 8px;
      text-align: left;
      cursor: pointer;
    }
    .choice.correct { background: #dcfce7; border-color: #16a34a; }
    .choice.wrong { background: #fee2e2; border-color: #ef4444; }
    .q-result {
      margin-top: 8px;
      font-size: 13px;
      color: #334155;
    }
    .progress {
      height: 10px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 8px;
    }
    .progress > i {
      display: block;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #16a34a, #22c55e);
      transition: width 0.2s ease;
    }
    @media (max-width: 600px) {
      .cards-grid { grid-template-columns: 1fr; }
      .choices { grid-template-columns: 1fr; }
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1220;
        --card: #111827;
        --ink: #e5e7eb;
        --muted: #9ca3af;
        --line: #253041;
      }
      .script-box { background: #0f172a; }
      .def-box { background: #1f2937; }
      .context { background: #0b2947; }
      .choice { background: #0f172a; }
      .q { background: #111827; }
    }
    @media print {
      .audio-wrap, .quiz-section { display: none !important; }
      .v-card .card-body { display: block !important; }
      .container { max-width: 100%; padding: 0; }
    }
  </style>
</head>
<body>
  <div class="container">
    <section class="panel hero">
      <h1 id="news-title"></h1>
      <div class="meta" id="news-meta"></div>
      <div class="header-row">
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <span class="badge" id="vocab-count-badge"></span>
          <span class="badge" id="bookmark-count-badge">Bookmarks 0</span>
        </div>
        <div class="cefr-chart" id="cefr-chart"></div>
      </div>
    </section>

    <section class="panel audio-wrap" id="audio-section">
      <h2>Audio Player</h2>
      <audio controls id="audio-player"></audio>
    </section>

    <section class="panel">
      <h2>Script Viewer</h2>
      <div class="script-tools">
        <div class="script-hint">Scroll to view full script. Use expand when needed.</div>
        <button id="script-toggle" class="script-toggle" type="button">Expand</button>
      </div>
      <div class="script-box" id="script-box"></div>
    </section>

    <section class="panel">
      <div class="cards-head">
        <h2 style="margin:0;">Vocabulary Cards</h2>
      </div>
      <div class="cards-grid" id="cards-grid"></div>
    </section>

    <section class="panel quiz-section" id="quiz-section">
      <h2>Fill-in Quiz</h2>
      <div id="quiz-score">0 / 0</div>
      <div class="progress"><i id="quiz-progress"></i></div>
      <div class="quiz-list" id="quiz-list" style="margin-top:12px;"></div>
    </section>
  </div>

  <script>
    const episode = {"date_display": "2026.02.26", "airtime": "21:55", "title": "21:55 Arirang News", "mp3_filename": "20260226_2155_arirang.mp4", "mp3_url": "https://download-arirang-com.akamaized.net/kr/media1/arirang/20260226/28637749/28637749_20260226-fby5tjn9_audio_arirang-mp3-normal-20260226220241.mp4?hdnts=exp=3544487944~acl=/kr/media1/arirang/20260226/28637749/*~hmac=f0a57634ba05045a5d0701eec8299c1f6e195a9ff3e8df468ddec612f9d24bc8", "script_text": "Welcome to Arirang News This is Park Kee hoon\nAnd we start with the top headlines at this hour.\n\n1.\nPyongyang held a large-scale military parade on Wednesday night\nto mark the 9th Congress of the Workers' Party of Korea,\nbut no major weapons systems appeared to be on display.\nIt's believed to be the first time in a decade that North Korea has not placed weapons or military equipment at the forefront of a key parade.\nKim Jong-un's daughter, Ju-ae, also attended the military parade,\ndrawing attention for her attire as she appeared in a matching\nleather jacket with her father and took a central position on the stairs.\nAccording to the North's state-run Korean Central News Agency\non Thursday, Kim Jong-un presented a report at the 9th Congress, reaffirming the regime‚Äôs strategic line of bolstering its nuclear capabilities.\nHe reasserted the permanent status of North Korea as a nuclear weapons state and his commitment to maintaining defense capabilities.\nHe also outlined a new five-year plan for defense buildup, citing on-land and underwater-launched ICBMs, AI-equipped drones, surveillance satellites and strategic and electric weapons.\n\n2.\nMeanwhile, President Lee Jae Myung once again vowed to continue his peace drive against North Korea, as he was critical of a hawkish stance\nby his predecessor.\nPursing values of peace and stability, while ending the past that was dashing towards confrontation and war, was the response by\nPresident Lee Jae Myung to a hostile message by North Korea's\nKim Jong-un, condemning the South during the regime's recent\npolitical event.\nPresident Lee was critical of his predecessor's hawkish stance\non North Korea and those who criticize his view as \"submissive,\"\nas he opened Thursday's weekly meeting with his aides.\n\n3.\nSouth Korea and the United Arab Emirates have agreed to pursue\ndefense cooperation projects worth 35 billion U.S. dollars.\nThat's according to Presidential Chief of Staff Kang Hoon-sik,\nwho returned from the UAE on Thursday after serving as\nPresident Lee Jae Myung's special envoy\nfor strategic economic cooperation.\nKang said he reached the agreement during talks with\nKhaldoon Khalifa Al Mubarak,\nAbu Dhabi‚Äôs Executive Affairs Authority Chairman.\nThe two sides signed a memorandum of understanding\noutlining cooperation in weapons design, training, and maintenance.\nKang also delivered a personal letter from President Lee\ninviting UAE President\nMohamed bin Zayed Al Nahyan to visit South Korea.\nThe two leaders held a summit last November during Lee's state visit\nto the UAE.\n\n4.\nThe Bank of Korea has yet again frozen the benchmark interest rate\nat 2.5 percent.\nThe decision came unanimously on Thursday after a\nmonetary policy board meeting.\nEntering 2025, the benchmark rate stood at 3.0 percent.\nSince May last year, the Board hasn't changed the rates\nfor six monetary policy committee meetings.\n\n5.\nSouth Korea's National Assembly today passed a revised Criminal Act bill, creating the crime of \"legal distortion,\" after a ruling party-led motion brought an end to an opposition filibuster\nand the bill cleared the chamber in a vote.\nThe amendment, one of the Democratic Party‚Äôs three flagship judicial\nreform measures, limits its application to criminal cases\nand clarifies its provisions amid earlier concerns over constitutionality.\nFollowing the vote, lawmakers moved on to the next item on the agenda,\na revision to the Constitutional Court Act introducing a\njudicial complaint system, which was formally reported to the floor.\nThe People Power Party immediately launched another filibuster,\nvowing to resist what it calls an excessive overhaul of the judicial system."};
    const rawVocabData = [{"word": "Myung's", "lemma": "myung's", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "That's according to Presidential Chief of Staff Kang Hoon-sik, \nwho returned from the UAE on Thursday after serving as \nPresident Lee Jae Myung's special envoy \nfor strategic economic cooperation.", "cefr_level": "C2", "frequency_score": 7.9706, "is_b2_plus": false, "derivatives": []}, {"word": "Khaldoon", "lemma": "khaldoon", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "Kang said he reached the agreement during talks with \nKhaldoon Khalifa Al Mubarak, \nAbu Dhabi‚Äôs Executive Affairs Authority Chairman.", "cefr_level": "C2", "frequency_score": 7.9393, "is_b2_plus": false, "derivatives": []}, {"word": "Arirang", "lemma": "arirang", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "Welcome to Arirang News This is Park Kee hoon \nAnd we start with the top headlines at this hour.", "cefr_level": "C1", "frequency_score": 6.9318, "is_b2_plus": false, "derivatives": []}, {"word": "Nahyan", "lemma": "nahyan", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "Kang also delivered a personal letter from President Lee \ninviting UAE President\nMohamed bin Zayed Al Nahyan to visit South Korea.", "cefr_level": "C1", "frequency_score": 6.8894, "is_b2_plus": false, "derivatives": []}, {"word": "Pursing", "lemma": "pursing", "pos": "", "pos_ko": "", "phonetic": "/p…úÀês/", "definition_en": "contract one's lips into a rounded shape", "translation_ko": "", "example_en": "she reached into her bag and found a comb", "context_sentence": "Pursing values of peace and stability, while ending the past that was dashing towards confrontation and war, was the response by \nPresident Lee Jae Myung to a hostile message by North Korea's \nKim Jong-un, condemning the South during the regime's recent \npolitical event.", "cefr_level": "C1", "frequency_score": 6.8097, "is_b2_plus": false, "derivatives": ["purse", "wrinkle"]}, {"word": "predecessor's", "lemma": "predecessor's", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "President Lee was critical of his predecessor's hawkish stance \non North Korea and those who criticize his view as \"submissive,\" \nas he opened Thursday's weekly meeting with his aides.", "cefr_level": "C1", "frequency_score": 6.719, "is_b2_plus": false, "derivatives": []}, {"word": "reasserted", "lemma": "reasserted", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "strengthen or make more firm", "translation_ko": "", "example_en": "The witnesses confirmed the victim's account", "context_sentence": "He reasserted the permanent status of North Korea as a nuclear weapons state and his commitment to maintaining defense capabilities.", "cefr_level": "C1", "frequency_score": 6.71, "is_b2_plus": false, "derivatives": ["confirm", "reassert"]}, {"word": "ICBMs", "lemma": "icbms", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "a ballistic missile that is capable of traveling from one continent to another", "translation_ko": "", "example_en": "", "context_sentence": "He also outlined a new five-year plan for defense buildup, citing on-land and underwater-launched ICBMs, AI-equipped drones, surveillance satellites and strategic and electric weapons.", "cefr_level": "C1", "frequency_score": 6.6198, "is_b2_plus": false, "derivatives": ["ICBM", "intercontinental ballistic missile"]}, {"word": "hawkish", "lemma": "hawkish", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "disposed to warfare or hard-line policies", "translation_ko": "", "example_en": "militant nations", "context_sentence": "Meanwhile, President Lee Jae Myung once again vowed to continue his peace drive against North Korea, as he was critical of a hawkish stance \nby his predecessor.", "cefr_level": "C1", "frequency_score": 6.5702, "is_b2_plus": false, "derivatives": ["militant", "warlike"]}, {"word": "Hoon-sik", "lemma": "hoon-sik", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "That's according to Presidential Chief of Staff Kang Hoon-sik, \nwho returned from the UAE on Thursday after serving as \nPresident Lee Jae Myung's special envoy \nfor strategic economic cooperation.", "cefr_level": "C1", "frequency_score": 6.4672, "is_b2_plus": false, "derivatives": []}, {"word": "bolstering", "lemma": "bolstering", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "support and strengthen", "translation_ko": "", "example_en": "bolster morale", "context_sentence": "According to the North's state-run Korean Central News Agency \non Thursday, Kim Jong-un presented a report at the 9th Congress, reaffirming the regime‚Äôs strategic line of bolstering its nuclear capabilities.", "cefr_level": "C1", "frequency_score": 6.4101, "is_b2_plus": false, "derivatives": ["bolster", "bolster up", "pad"]}, {"word": "Zayed", "lemma": "zayed", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "Kang also delivered a personal letter from President Lee \ninviting UAE President\nMohamed bin Zayed Al Nahyan to visit South Korea.", "cefr_level": "C1", "frequency_score": 6.3904, "is_b2_plus": false, "derivatives": []}, {"word": "reaffirming", "lemma": "reaffirming", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "affirm once again", "translation_ko": "", "example_en": "He reaffirmed his faith in the church", "context_sentence": "According to the North's state-run Korean Central News Agency \non Thursday, Kim Jong-un presented a report at the 9th Congress, reaffirming the regime‚Äôs strategic line of bolstering its nuclear capabilities.", "cefr_level": "C1", "frequency_score": 6.3497, "is_b2_plus": false, "derivatives": ["reaffirm"]}, {"word": "North's", "lemma": "north's", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "According to the North's state-run Korean Central News Agency \non Thursday, Kim Jong-un presented a report at the 9th Congress, reaffirming the regime‚Äôs strategic line of bolstering its nuclear capabilities.", "cefr_level": "C1", "frequency_score": 6.3298, "is_b2_plus": false, "derivatives": []}, {"word": "vowing", "lemma": "vowing", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "make a vow; promise", "translation_ko": "", "example_en": "He vowed never to drink alcohol again", "context_sentence": "The People Power Party immediately launched another filibuster, \nvowing to resist what it calls an excessive overhaul of the judicial system.", "cefr_level": "C1", "frequency_score": 6.3197, "is_b2_plus": false, "derivatives": ["consecrate", "vow"]}, {"word": "regime's", "lemma": "regime's", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "Pursing values of peace and stability, while ending the past that was dashing towards confrontation and war, was the response by \nPresident Lee Jae Myung to a hostile message by North Korea's \nKim Jong-un, condemning the South during the regime's recent \npolitical event.", "cefr_level": "C1", "frequency_score": 6.2798, "is_b2_plus": false, "derivatives": []}, {"word": "Jong-un's", "lemma": "jong-un's", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "Kim Jong-un's daughter, Ju-ae, also attended the military parade, \ndrawing attention for her attire as she appeared in a matching \nleather jacket with her father and took a central position on the stairs.", "cefr_level": "C1", "frequency_score": 6.2147, "is_b2_plus": false, "derivatives": []}, {"word": "Myung", "lemma": "myung", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "Meanwhile, President Lee Jae Myung once again vowed to continue his peace drive against North Korea, as he was critical of a hawkish stance \nby his predecessor.", "cefr_level": "C1", "frequency_score": 6.1798, "is_b2_plus": false, "derivatives": []}, {"word": "filibuster", "lemma": "filibuster", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "a legislator who gives long speeches in an effort to delay or obstruct legislation that he (or she) opposes", "translation_ko": "", "example_en": "", "context_sentence": "South Korea's National Assembly today passed a revised Criminal Act bill, creating the crime of \"legal distortion,\" after a ruling party-led motion brought an end to an opposition filibuster \nand the bill cleared the chamber in a vote.", "cefr_level": "C1", "frequency_score": 6.1101, "is_b2_plus": false, "derivatives": ["filibusterer"]}, {"word": "constitutionality", "lemma": "constitutionality", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "The status of being constitutional; of being in accord with the provisions of the appropriate constitution", "translation_ko": "", "example_en": "", "context_sentence": "The amendment, one of the Democratic Party‚Äôs three flagship judicial \nreform measures, limits its application to criminal cases \nand clarifies its provisions amid earlier concerns over constitutionality.", "cefr_level": "C1", "frequency_score": 6.06, "is_b2_plus": false, "derivatives": []}, {"word": "clarifies", "lemma": "clarifies", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "make clear and (more) comprehensible", "translation_ko": "", "example_en": "clarify the mystery surrounding her death", "context_sentence": "The amendment, one of the Democratic Party‚Äôs three flagship judicial \nreform measures, limits its application to criminal cases \nand clarifies its provisions amid earlier concerns over constitutionality.", "cefr_level": "C1", "frequency_score": 6.0301, "is_b2_plus": false, "derivatives": ["clarify", "clear up", "elucidate"]}, {"word": "hoon", "lemma": "hoon", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "A worthless person; a hooligan or lout.", "translation_ko": "", "example_en": "", "context_sentence": "Welcome to Arirang News This is Park Kee hoon \nAnd we start with the top headlines at this hour.", "cefr_level": "C1", "frequency_score": 6.0101, "is_b2_plus": false, "derivatives": []}, {"word": "Pyongyang", "lemma": "pyongyang", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "capital of North Korea and an industrial center", "translation_ko": "", "example_en": "Pyongyang is Korea's oldest city but little of its history has been preserved", "context_sentence": "Pyongyang held a large-scale military parade on Wednesday night \nto mark the 9th Congress of the Workers' Party of Korea, \nbut no major weapons systems appeared to be on display.", "cefr_level": "B2", "frequency_score": 5.8894, "is_b2_plus": false, "derivatives": ["Pyongyang", "capital of North Korea"]}, {"word": "Thursday's", "lemma": "thursday's", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "President Lee was critical of his predecessor's hawkish stance \non North Korea and those who criticize his view as \"submissive,\" \nas he opened Thursday's weekly meeting with his aides.", "cefr_level": "B2", "frequency_score": 5.8894, "is_b2_plus": false, "derivatives": []}, {"word": "Ju-ae", "lemma": "ju-ae", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "Kim Jong-un's daughter, Ju-ae, also attended the military parade, \ndrawing attention for her attire as she appeared in a matching \nleather jacket with her father and took a central position on the stairs.", "cefr_level": "B2", "frequency_score": 5.7721, "is_b2_plus": false, "derivatives": []}, {"word": "Mubarak", "lemma": "mubarak", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "Egyptian statesman who became president in 1981 after Sadat was assassinated (born in 1929)", "translation_ko": "", "example_en": "", "context_sentence": "Kang said he reached the agreement during talks with \nKhaldoon Khalifa Al Mubarak, \nAbu Dhabi‚Äôs Executive Affairs Authority Chairman.", "cefr_level": "B2", "frequency_score": 5.7595, "is_b2_plus": false, "derivatives": ["Hosni Mubarak", "Mubarak"]}, {"word": "submissive", "lemma": "submissive", "pos": "", "pos_ko": "", "phonetic": "/s…ôbÀàm…™s…™v/", "definition_en": "inclined or willing to submit to orders or wishes of others or showing such inclination", "translation_ko": "", "example_en": "submissive servants", "context_sentence": "President Lee was critical of his predecessor's hawkish stance \non North Korea and those who criticize his view as \"submissive,\" \nas he opened Thursday's weekly meeting with his aides.", "cefr_level": "B2", "frequency_score": 5.7496, "is_b2_plus": false, "derivatives": ["slavish", "subservient"]}, {"word": "Khalifa", "lemma": "khalifa", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "", "translation_ko": "", "example_en": "", "context_sentence": "Kang said he reached the agreement during talks with \nKhaldoon Khalifa Al Mubarak, \nAbu Dhabi‚Äôs Executive Affairs Authority Chairman.", "cefr_level": "B2", "frequency_score": 5.7399, "is_b2_plus": false, "derivatives": []}, {"word": "dashing", "lemma": "dashing", "pos": "", "pos_ko": "", "phonetic": "/Ààd√¶ É…™≈ã(…°)/", "definition_en": "run or move very quickly or hastily", "translation_ko": "", "example_en": "She dashed into the yard", "context_sentence": "Pursing values of peace and stability, while ending the past that was dashing towards confrontation and war, was the response by \nPresident Lee Jae Myung to a hostile message by North Korea's \nKim Jong-un, condemning the South during the regime's recent \npolitical event.", "cefr_level": "B2", "frequency_score": 5.7305, "is_b2_plus": false, "derivatives": ["crash", "dart", "dash", "daunt", "flash", "frighten away", "frighten off", "pall", "scare", "scare away", "scare off", "scoot", "scud", "shoot", "smash"]}, {"word": "outlining", "lemma": "outlining", "pos": "", "pos_ko": "", "phonetic": "", "definition_en": "describe roughly or briefly or give the main points or summary of", "translation_ko": "", "example_en": "sketch the outline of the book", "context_sentence": "The two sides signed a memorandum of understanding \noutlining cooperation in weapons design, training, and maintenance.", "cefr_level": "B2", "frequency_score": 5.6904, "is_b2_plus": false, "derivatives": ["adumbrate", "delineate", "draft", "limn", "outline", "sketch"]}];
    const vocabData = JSON.parse(JSON.stringify(rawVocabData));
    const bookmarksKey = "arirang_bookmarks";

    function escHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }

    function cleanInlineArtifacts(s) {
      let t = String(s ?? "");
      t = t.replace(/\bdata\s*-\s*[a-z-]+\s*=\s*(?:'[^']*'|"[^"]*"|[^\s>]+)\s*(?:>|&gt;|&amp;gt;)?/gi, "");
      t = t.replace(/data-[a-z-]+\s*=\s*(?:&#39;[^&#]*&#39;|&quot;[^&]*&quot;|[^\s&]+)\s*(?:&gt;)?/gi, "");
      t = t.replace(/<[^>]+>/g, "");
      return t;
    }

    function loadBookmarks() {
      try {
        return JSON.parse(localStorage.getItem(bookmarksKey) || "{}");
      } catch (_) {
        return {};
      }
    }

    function saveBookmarks(bm) {
      localStorage.setItem(bookmarksKey, JSON.stringify(bm));
    }

    function cefrClass(level) {
      if (level === "C2") return "mark-c2";
      if (level === "C1") return "mark-c1";
      if (level === "B2") return "mark-b2";
      return "";
    }

    function openCard(lemma) {
      const el = document.getElementById("card-" + lemma);
      if (!el) return;
      el.classList.add("open");
      el.scrollIntoView({ behavior: "smooth", block: "center" });
    }

    function renderHeader() {
      document.getElementById("news-title").textContent = episode.title || "Arirang News";
      document.getElementById("news-meta").innerHTML =
        "<span>" + escHtml(episode.date_display || "") + "</span>" +
        "<span>/</span>" +
        "<span>" + escHtml(episode.airtime || "21:55") + "</span>";

      document.getElementById("vocab-count-badge").textContent = "Vocab " + vocabData.length;

      const dist = { B2:0, C1:0, C2:0 };
      for (const v of vocabData) {
        if (v.cefr_level === "B2") dist.B2++;
        if (v.cefr_level === "C1") dist.C1++;
        if (v.cefr_level === "C2") dist.C2++;
      }
      const max = Math.max(1, dist.B2, dist.C1, dist.C2);
      const chart = document.getElementById("cefr-chart");
      chart.innerHTML = ["B2","C1","C2"].map(k => {
        const h = Math.max(6, Math.round((dist[k] / max) * 56));
        return "<div class='cefr-col'>" +
               "<div class='cefr-bar' style='height:" + h + "px'></div>" +
               "<div>" + k + "</div>" +
               "</div>";
      }).join("");
    }

    function renderAudio() {
      const section = document.getElementById("audio-section");
      const player = document.getElementById("audio-player");
      const bust = "?v=" + Date.now();
      if (!episode.mp3_filename && !episode.mp3_url) {
        section.style.display = "none";
        return;
      }
      if (episode.mp3_filename) {
        // report file is in reports/, media files are in downloads/
        player.src = "../downloads/" + episode.mp3_filename + bust;
      } else {
        player.src = episode.mp3_url + (String(episode.mp3_url).includes("?") ? "&v=" : "?v=") + Date.now();
      }
    }

    function renderScript() {
      const box = document.getElementById("script-box");
      const toggle = document.getElementById("script-toggle");
      let src = String(episode.script_text || "");
      // Defensive cleanup for raw/encoded inline attribute residue.
      src = src.replace(/\bdata\s*-\s*[a-z-]+\s*=\s*(?:'[^']*'|"[^"]*"|[^\s>]+)\s*(?:>|&gt;|&amp;gt;)?/gi, "");
      src = src.replace(/(^|\s)-\s*[a-z-]+\s*=\s*(?:'[^']*'|"[^"]*"|[^\s<]+)\s*(?:>|&gt;|&amp;gt;)?/gi, "$1");
      let text = escHtml(src);
      text = text.replace(/data\s*-\s*[a-z-]+\s*=\s*(?:&#39;[^&#]*&#39;|&quot;[^&]*&quot;|[^\s&]+)\s*(?:&gt;|&amp;gt;)?/gi, "");
      text = text.replace(/(^|\s)-\s*[a-z-]+\s*=\s*(?:&#39;[^&#]*&#39;|&quot;[^&]*&quot;|[^\s<]+)\s*(?:&gt;|&amp;gt;)?/gi, "$1");
      if (!text) {
        box.textContent = "Script is not available.";
        toggle.style.display = "none";
        return;
      }

      const sorted = [...vocabData]
        .filter(v => v.word)
        .sort((a,b) => String(b.word).length - String(a.word).length);

      const byLower = new Map();
      const escapedWords = [];
      for (const item of sorted) {
        const word = String(item.word || "").trim();
        if (!word) continue;
        const lower = word.toLowerCase();
        if (!byLower.has(lower)) {
          byLower.set(lower, item);
        }
        escapedWords.push(word.replace(/[.*+?^${}()|[\\]\\]/g, "\\$&"));
      }
      if (escapedWords.length) {
        const pattern = new RegExp("\\b(" + escapedWords.join("|") + ")\\b", "gi");
        text = text.replace(pattern, (m) => {
          const item = byLower.get(String(m).toLowerCase());
          if (!item) return m;
          const lemma = String(item.lemma || "").trim();
          const cls = cefrClass(item.cefr_level);
          return "<mark class='" + cls + "' data-key='" + escHtml(lemma) + "'>" + m + "</mark>";
        });
      }

      box.innerHTML = text;
      box.querySelectorAll("mark[data-key]").forEach((el) => {
        el.addEventListener("click", () => openCard(el.getAttribute("data-key")));
      });

      toggle.addEventListener("click", () => {
        box.classList.toggle("expanded");
        toggle.textContent = box.classList.contains("expanded") ? "Collapse" : "Expand";
      });
    }

    function renderCards() {
      const bm = loadBookmarks();
      const grid = document.getElementById("cards-grid");
      grid.innerHTML = vocabData.map((v) => {
        const lemma = escHtml(v.lemma || "");
        const ko = String(v.translation_ko || "").trim() || "Not listed in dictionary";
        const deriv = Array.isArray(v.derivatives) ? v.derivatives : [];
        const tags = deriv.map(x => "<span class='tag'>" + escHtml(x) + "</span>").join("");
        const bookmarked = bm[v.word] ? "bookmarked" : "";
        const pressed = bm[v.word] ? "true" : "false";
        const definition = cleanInlineArtifacts(v.definition_en || "");
        const example = cleanInlineArtifacts(v.example_en || "");
        const context = cleanInlineArtifacts(v.context_sentence || "");
        return "<article class='v-card " + bookmarked + "' id='card-" + lemma + "'>" +
               "<button class='bookmark-btn' data-word='" + escHtml(v.word) + "' aria-pressed='" + pressed + "'>üîñ</button>" +
               "<div class='card-top'>" +
               "<span class='word'>" + escHtml(v.word || "") + "</span>" +
               "<span class='cefr'>" + escHtml(v.cefr_level || "") + "</span>" +
               "<span class='phonetic'>" + escHtml(v.phonetic || "") + "</span>" +
               "</div>" +
               "<div class='sub'>" + escHtml(v.pos_ko || "") + " | Frequency " + escHtml(v.frequency_score) + "</div>" +
               "<div class='card-body'>" +
               "<div class='def-box'>" + escHtml(definition) + "</div>" +
               "<div class='ko'>" + escHtml(ko) + "</div>" +
               "<div class='example'>" + escHtml(example) + "</div>" +
               "<div class='context'>" + escHtml(context) + "</div>" +
               "<div class='tags'>" + tags + "</div>" +
               "</div>" +
               "</article>";
      }).join("");

      grid.querySelectorAll(".v-card").forEach((card) => {
        card.addEventListener("click", (ev) => {
          if (ev.target && ev.target.classList.contains("bookmark-btn")) return;
          card.classList.toggle("open");
        });
      });

      grid.querySelectorAll(".bookmark-btn").forEach((btn) => {
        btn.addEventListener("click", (ev) => {
          ev.stopPropagation();
          const word = btn.getAttribute("data-word");
          const store = loadBookmarks();
          store[word] = !store[word];
          if (!store[word]) delete store[word];
          saveBookmarks(store);
          renderCards();
          updateBookmarkCount();
        });
      });
    }

    function updateBookmarkCount() {
      const bm = loadBookmarks();
      const n = Object.keys(bm).length;
      document.getElementById("bookmark-count-badge").textContent = "Bookmarks " + n;
    }

    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function buildQuizItems() {
      const withCtx = vocabData.filter(v => cleanInlineArtifacts(v.context_sentence || "").trim() && v.word);
      const picked = shuffle(withCtx).slice(0, 5);
      const words = vocabData.map(v => v.word).filter(Boolean);
      return picked.map((q, idx) => {
        const answer = q.word;
        const wrongPool = shuffle(words.filter(w => w !== answer)).slice(0, 3);
        const choices = shuffle([answer, ...wrongPool]);
        const cleanCtx = cleanInlineArtifacts(q.context_sentence || "");
        const stem = cleanCtx.replace(new RegExp("\\b" + answer.replace(/[.*+?^${}()|[\\]\\]/g, "\\$&") + "\\b", "i"), "______");
        return {
          id: idx + 1,
          answer,
          choices,
          stem,
          definition: q.definition_en || ""
        };
      });
    }

    function renderQuiz() {
      const list = document.getElementById("quiz-list");
      const scoreEl = document.getElementById("quiz-score");
      const progress = document.getElementById("quiz-progress");
      const items = buildQuizItems();
      if (!items.length) {
        document.getElementById("quiz-section").style.display = "none";
        return;
      }

      let answered = 0;
      let correct = 0;

      function refresh() {
        scoreEl.textContent = correct + " / " + items.length;
        progress.style.width = Math.round((answered / items.length) * 100) + "%";
      }

      list.innerHTML = items.map((q) => {
        return "<div class='q' data-id='" + q.id + "'>" +
               "<div class='stem'><strong>Q" + q.id + ".</strong> " + escHtml(q.stem) + "</div>" +
               "<div class='choices'>" +
               q.choices.map(c => "<button class='choice' data-choice='" + escHtml(c) + "'>" + escHtml(c) + "</button>").join("") +
               "</div>" +
               "<div class='q-result'></div>" +
               "</div>";
      }).join("");

      list.querySelectorAll(".q").forEach((qEl) => {
        const id = Number(qEl.getAttribute("data-id"));
        const q = items.find(x => x.id === id);
        if (!q) return;
        let done = false;
        qEl.querySelectorAll(".choice").forEach((btn) => {
          btn.addEventListener("click", () => {
            if (done) return;
            done = true;
            answered++;
            const picked = btn.getAttribute("data-choice");
            const result = qEl.querySelector(".q-result");
            qEl.querySelectorAll(".choice").forEach((b) => {
              const val = b.getAttribute("data-choice");
              if (val === q.answer) b.classList.add("correct");
            });
            if (picked === q.answer) {
              correct++;
              btn.classList.add("correct");
              result.textContent = "Correct! " + (q.definition ? q.definition : "");
            } else {
              btn.classList.add("wrong");
              result.textContent = "Incorrect. Answer: " + q.answer + (q.definition ? " | " + q.definition : "");
            }
            refresh();
          });
        });
      });

      refresh();
    }

    renderHeader();
    renderAudio();
    renderScript();
    renderCards();
    updateBookmarkCount();
    renderQuiz();
  </script>
</body>
</html>
